- **Discovered by**: vmpr0be
- **Severity**: Critical
- **Impact**: Full arbitrary memory write using crafted values, attacker can overwrite storage_ptr inside player->craft_items
- **Affected versions**: Starting from commit ``ba86dfd927b5e2432be797e12095642dc4091fe1``
- **Technical Summary**: A userâ€‘controlled slot index is used to compute pointers into either inventory or chest storage. Because the slot is not validated, an attacker may overwrite arbitrary memory, including `player->craft_items`, enabling manipulation of `storage_ptr` and achieving arbitrary writes.
- **Path**: `handlePacket` -> `cs_clickContainer` -> `interactEntity`

```c
int cs_clickContainer (int client_fd) {
...
    int window_id = readVarInt(client_fd);
...
    uint8_t slot, count, craft = false;
    uint16_t item;
    int tmp;
    uint16_t *p_item;
    uint8_t *p_count;
...
    for (int i = 0; i < changes_count; i ++) {
    slot = clientSlotToServerSlot(window_id, readUint16(client_fd)); <== user-controlled value
...
#ifdef ALLOW_CHESTS
    if (window_id == 2 && slot > 40) {
        p_item = (uint16_t *)(storage_ptr + (slot - 41) * 3);
        p_count = storage_ptr + (slot - 41) * 3 + 2;
    } else
#endif
    {
        p_item = &player->inventory_items[slot];
        p_count = &player->inventory_count[slot];
    }
...
    if (count > 0 && apply_changes) {
        *p_item = item; <===== overwrite arbitrary element
        *p_count = count;
...
}
...
```
